TechMarket AI — Capítulo 12 Transacciones, Pagos, Comisiones y Monetización (premium + performance, sin romper confianza) Propósito del capítulo: definir e implementar la capa que convierte uso en ingresos, de forma transparente, auditable y escalable . En TechMarket AI, monetizar “como en las grandes ligas” significa: cobrar por valor real (visibilidad, leads, performance, premium), mantener control financiero (ledger, conciliación) y proteger al usuario (claridad, antifraude). 12.1. Principio central: monetizar sin matar el producto Un marketplace puede monetizar agresivamente y perder confianza. TechMarket AI debe lograr un equilibrio: - el usuario siente que encuentra buenas opciones, no “solo anuncios”. - el negocio siente que el premium trae resultados medibles. - el embajador recibe comisiones por impacto real (Cap. 9). Regla: la monetización debe ser consistente con el ranking híbrido (Cap. 3/7) y la reputación (Cap. 10). 12.2. Fuentes de ingresos (modelo freemium con IA) 12.2.1 Premium para negocios (suscripción) Beneficios típicos: - mayor visibilidad en mapa y búsqueda (boost moderado y transparente). - perfil avanzado (más fotos, videos, badges). - herramientas CRM (Cap. 11) más potentes. - analítica avanzada (Cap. 14). - automatizaciones (follow-up, campañas, IA de respuestas) con límites superiores. 12.2.2 Performance monetization (por resultados) costo por lead (CPL) verificado. costo por ticket creado. costo por cotización aprobada. 12.2.3 Publicidad controlada (fase 2) “promoted listings” dentro de búsquedas específicas. siempre etiquetado como promovido. 12.2.4 Servicios financieros (fase 3) escrow, pagos integrados, financiamiento. MVP recomendado: premium + performance (CPL/ticket). 12.3. Qué es una “transacción” en TechMarket AI No todas las transacciones son pagos directos. Para monetización, definimos transacciones como: 12.3.1 Transacción de suscripción compra/renovación de plan premium. 12.3.2 Transacción de performance evento monetizable (lead, ticket, quote aprobado). 12.3.3 Transacción de payout pago a embajador. Principio: todo debe tener referencia y auditoría. 12.4. Ledger financiero (libro mayor) como base Este capítulo hereda el concepto de ledger del Cap. 9, pero lo expande para toda monetización. 12.4.1 Por qué ledger evitar “cálculos sueltos”. conciliación. auditoría y disputas. 12.4.2 Modelo ledger recomendado cuentas (accounts): ingresos por suscripción ingresos por performance pasivo de comisiones por pagar ajustes/reversos entradas (ledger_entry): debit/credit moneda referencia (subscription_id, lead_id, ticket_id) Enterprise: incluso si no haces contabilidad completa, ledger mínimo es imprescindible. 12.5. Suscripciones premium (plan y facturación) 12.5.1 Planes FREE PREMIUM PREMIUM_PLUS (fase 2) 12.5.2 Facturación ciclo mensual. renovaciones. grace period. cancelación. 12.5.3 Límites (feature gating) El premium no solo es visibilidad, también es capacidad: - cantidad de listings. - cantidad de sucursales. - IA usage (respuestas, triage). - campañas. Regla: el free debe ser útil, premium debe ser irresistible. 12.6. Performance fees: cobrar por leads/tickets “buenos” 12.6.1 Definición de “lead monetizable” Para no cobrar por basura: - lead debe tener mínimo de calidad: - origen válido, - datos mínimos, - no duplicado, - no fraude. 12.6.2 Duplicados deduplicación por usuario + listing + ventana de tiempo. 12.6.3 Disputas negocio puede disputar un lead (fraude/spam). soporte revisa. Principio: el performance fee debe ser percibido como justo. 12.7. Pagos (payment gateway) y estrategia No fijamos proveedor sin validar país/operación. Diseñamos abstracción: 12.7.1 Payment Provider Interface authorize capture refund webhook_handler 12.7.2 Opciones típicas Stripe, MercadoPago, PayPal, pagos locales. 12.7.3 Recomendación enterprise usar webhooks para estado. idempotency keys. reconciliación diaria. 12.8. Comisiones (embajadores) integradas al sistema financiero El payout de embajadores (Cap. 9) ahora se conecta a: - suscripciones premium activadas. - performance monetization. Regla: comisiones se pagan cuando ingresos están confirmados (captured), no cuando “se intentó cobrar”. 12.9. Reversos y clawbacks 12.9.1 Reversos chargeback o cancelación. fraude detectado. 12.9.2 Clawback si pagaste comisión por un ingreso luego revertido. se descuenta de futuro payout. Enterprise: esto debe estar en términos y condiciones. 12.10. Transparencia en UI (para confianza) 12.10.1 Para negocios dashboard premium: qué obtuvieron. dashboard performance: leads cobrados vs disputados. historial de facturas. 12.10.2 Para embajadores ingresos por ciclo. eventos que generaron comisión. reversos. 12.10.3 Para usuarios contenido promovido etiquetado. no manipulación oculta. 12.11. Modelo de datos recomendado 12.11.1 PostgreSQL Tablas: - subscription - tenant_id , plan , status - current_period_start , current_period_end - cancel_at_period_end - version invoice tenant_id , subscription_id amount , currency , status provider_payment_id payment_transaction type (SUBSCRIPTION, PERFORMANCE) amount , currency status (AUTHORIZED/CAPTURED/FAILED/REFUNDED) idempotency_key performance_charge tenant_id event_type (LEAD, TICKET, QUOTE_APPROVED) ref_id (lead_id/ticket_id) amount , status (PENDING/CHARGED/DISPUTED/REVERSED) dispute_case type (LEAD_DISPUTE) ref_id , tenant_id status ledger_entry account , debit , credit , currency ref_type , ref_id timestamps payout / payout_cycle (Cap. 9) 12.11.2 MongoDB billing_documents (pdfs, evidencias) provider_webhook_payloads (auditoría) 12.11.3 Redis idempotency cache rate limit pagos 12.12. APIs 12.12.1 Suscripción POST /billing/subscriptions/start POST /billing/subscriptions/cancel GET /billing/subscriptions/me (por tenant) 12.12.2 Invoices GET /billing/invoices GET /billing/invoices/{id} 12.12.3 Performance GET /billing/performance/charges POST /billing/performance/charges/{id}/dispute 12.12.4 Webhooks POST /billing/webhooks/{provider} 12.13. Implementación (paso a paso) Paso 1 — Planes y feature flags definir límites por plan. middleware para gating. Paso 2 — Suscripción crear subscription. integrar provider. webhooks. Paso 3 — Invoices generar invoice por periodo. registrar ledger. Paso 4 — Performance charges cuando se crea lead/ticket monetizable → PENDING . se cobra por ciclo (diario/semanal) o inmediato. Paso 5 — Disputas flujo de disputa. ajuste ledger. Paso 6 — Comisiones integrar ingresos confirmados con payouts. 12.14. Pruebas y definición de “listo” Casos esenciales iniciar suscripción. webhook confirma pago. generar invoice. crear performance charge por lead. disputa y reverso. payout embajador con ingresos confirmados. Listo significa el negocio confía en el cobro. embajador confía en pagos. la plataforma es auditable. 12.15. Conexión con el Capítulo 13 Monetizar no sirve si la operación no escala. El siguiente capítulo define: - Arquitectura de notificaciones, eventos, jobs y mensajería (event-driven) para escalar sin caos. Fin del Capítulo 12
