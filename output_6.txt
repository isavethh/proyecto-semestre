TechMarket AI — Capítulo 3 Negocios, Sucursales, Verificación, Geolocalización y Mapa (descubrimiento con confianza) Propósito del capítulo: construir el “mundo físico y comercial” del ecosistema. Aquí definimos cómo nacen los negocios (tiendas/talleres), cómo se organizan por sucursales, cómo se verifican , y cómo se vuelven descubribles en el mapa con señales de confianza. Sin este capítulo, el marketplace no tiene base. 3.1. La idea central: un mapa sin confianza es solo un directorio Un mapa con puntos (tiendas/talleres) no resuelve el problema real del rubro. TechMarket AI necesita un mapa con: - Identidad y legitimidad (verificación). - Calidad operacional (tiempos de respuesta, cumplimiento, evidencia). - Oferta clara (qué vende/hace, categorías, servicios). - Ubicación precisa (sucursal real, no “aproximada” ). Principio enterprise: la “confianza” se modela como datos y métricas, no como marketing. 3.2. Tipos de negocio (Taxonomía del ecosistema) En TechMarket AI, un “negocio” es un tenant con una naturaleza operacional. Una taxonomía mínima robusta: 3.2.1 Tipos principales Tienda de electrónica/computación (venta de equipos, periféricos, accesorios). Taller técnico (reparación, mantenimiento, upgrades). Integrador de redes/IT (instalación y soporte de redes, cámaras, servidores). Servicio especializado (micro-soldadura, reballing, data recovery, impresoras, Apple/Android, consolas). Mayorista / Distribuidor (B2B, volumen, precios por escala) — fase 2 o 3. 3.2.2 Etiquetas (tags) por capacidad Ejemplos: - “Reparación laptops” , “Reparación PC” , “Consolas” , “Impresoras” , “CCTV” , “Redes Wi‑Fi” , “Cableado” , “Servidores” , “Venta gamer” , “Venta empresarial” . Regla: el tipo define flujos (tickets, agenda, diagnósticos), y los tags definen descubrimiento y ranking. 3.3. Multi-sucursal: por qué es crítico Un negocio serio puede tener varias sucursales con: - horarios distintos, - inventario/servicios por sucursal, - reputación local, - técnicos asignados por sede, - tiempos de respuesta diferentes. Decisión de diseño recomendada: - El tenant agrupa identidad comercial, verificación y planes premium. - La sucursal define ubicación, horarios, cobertura, equipo operativo y métricas locales. Esto permite: - ranking por zona, - operación real (tickets/agenda), - crecimiento gradual (abrir nuevas sedes sin duplicar la empresa). 3.4. Geolocalización: cómo se hace bien 3.4.1 Coordenadas y normalización Cada sucursal debe almacenar: - lat , lng (precisión real) - dirección normalizada (calle, zona, referencia) - ciudad/municipio/país - Place ID (si usas Google Places) o un identificador equivalente (Mapbox, OpenStreetMap Nominatim) Por qué el Place ID importa: reduce duplicados, permite validar existencia y mejora búsquedas. 3.4.2 Motor geo recomendado Para “grandes ligas” , la opción más sólida es: - PostgreSQL + PostGIS para queries geoespaciales eficientes. - Índices GiST y funciones nativas ( ST_DWithin , ST_Distance ). Alternativa (si no hay PostGIS): - guardar lat/lng en Postgres + índices por geohash (o tiles) + filtro por bounding box + cálculo Haversine. Recomendación: usa PostGIS desde el inicio. El mapa es core del producto. 3.4.3 Cobertura de servicio (service area) Algunos negocios atienden a domicilio o por zona. Modela: - radio en km (simple), o - polígono (avanzado), o - lista de zonas. Esto sirve para: - filtrar por cobertura, - cotizaciones a domicilio, - priorizar negocios cercanos. 3.5. Verificación (KYC/KYB) del negocio: el “check azul” del sector 3.5.1 Estados de verificación UNVERIFIED (creado, sin documentos) PENDING_REVIEW (documentos enviados) VERIFIED (aprobado) REJECTED (rechazado con motivo) SUSPENDED (sospecha/fraude) EXPIRED (debe revalidar) 3.5.2 Qué se verifica Mínimo viable (piloto): - identidad del owner (documento) - evidencia del local o actividad (foto del local, factura de servicios, NIT si aplica) - teléfono y canal de contacto Ideal (escala): - NIT/registro comercial - ubicación confirmada (place id + foto) - evidencia de operación (tickets/servicios) - referencias o validación comunitaria controlada 3.5.3 Proceso de revisión (backoffice) negocio sube documentos. sistema asigna caso a soporte/moderación . revisión con checklist. decisión: aprobado/rechazado. si rechazado: motivo + pasos para corregir. auditoría total (quién aprobó, cuándo, evidencia). Regla antifraude: el verificado tiene peso en ranking; por tanto, debe ser difícil de falsificar. 3.6. Señales de confianza (Trust Signals) visibles al usuario La confianza se comunica con señales claras, medibles y difíciles de manipular: 3.6.1 Señales “hard” (fuertes) Verificado . antigüedad del negocio en plataforma. tasa de respuesta (SLA) y tiempo promedio. cumplimiento (tickets cerrados con evidencia). 3.6.2 Señales “soft” (sociales) rating y reseñas. cantidad de servicios/ventas atendidas. badges por especialidad (ej. “Especialista en consolas” ). 3.6.3 Señales de transparencia horarios claros. servicios y precios estimados (cuando aplique). garantía declarada. Principio: mostrar menos señales pero más confiables es mejor que mostrar muchas sin control. 3.7. Ranking en el mapa (la fórmula que mueve el negocio) El ranking define el valor real del premium y la percepción de utilidad del usuario. Debe ser: - útil (primero lo más relevante), - justo (no solo paga-gana), - robusto (resistente a spam/fraude). 3.7.1 Componentes del ranking (recomendado) Distancia (peso fuerte en búsquedas locales). Match de intención/categoría (si el usuario busca “reparación laptop” , una tienda general no debe dominar). Confianza (verificado, métricas operacionales). Reputación (rating con corrección estadística: bayesiano para evitar manipulación por pocas reseñas). Calidad de perfil (completitud, fotos, catálogo). Boost premium (moderado y transparente). 3.7.2 Antimanipulación limitar reseñas por compra/ticket real (en fases avanzadas). detectar patrones sospechosos (picos de reseñas, IPs repetidas). cooldown de boosts. 3.8. Modelo de datos (diseño recomendado) Objetivo: permitir multi-sucursal, verificación, mapa y ranking con auditoría. 3.8.1 PostgreSQL (transaccional) Entidad: tenant (negocio) - id , legal_name , trade_name - type (STORE, WORKSHOP, INTEGRATOR, SPECIALIZED) - status (ACTIVE, SUSPENDED) - verification_status (enum) - premium_plan (FREE, PREMIUM) - created_at , updated_at - version ( @Version ) Entidad: tenant_branch (sucursal) - id , tenant_id - name (Sucursal Centro) - address_text , city , country - location (PostGIS Point) - phone , whatsapp - is_main - service_radius_km (opcional) - status (ACTIVE, INACTIVE) - created_at , updated_at - version ( @Version ) Entidad: tenant_category / tenant_tag - para vincular tipos, categorías y tags. Entidad: tenant_public_profile (opcional) - fotos principales, descripción, links. Entidad: tenant_metrics_daily - tiempos de respuesta, tickets, conversiones (se alimenta por eventos). Entidad: verification_case - id , tenant_id , branch_id? - status (PENDING, APPROVED, REJECTED) - assigned_to (moderador) - decision_reason - timestamps Índices críticos - tenant_branch(location) GiST - tenant(verification_status) - tenant_branch(tenant_id) - tenant_metrics_daily(tenant_id, day) 3.8.2 MongoDB (documentos y evidencia) verification_documents : fotos, PDFs, metadatos, hash del archivo, estado. branch_media : álbum de fotos por sucursal. 3.8.3 Redis (performance) cache de resultados geo por tiles (ej. tile:{z}:{x}:{y}:{filtersHash} ) cache de ranking por zona rate limit para creación/edición de sucursales (anti spam) 3.9. APIs (REST recomendado para este módulo) 3.9.1 Negocios y sucursales (owner/admin) POST /tenants (crear negocio) POST /tenants/{tenantId}/branches PATCH /tenants/{tenantId}/branches/{branchId} GET /tenants/{tenantId}/branches POST /tenants/{tenantId}/branches/{branchId}/media 3.9.2 Verificación POST /tenants/{tenantId}/verification/submit GET /tenants/{tenantId}/verification/status POST /backoffice/verification/{caseId}/approve POST /backoffice/verification/{caseId}/reject 3.9.3 Mapa y discovery (cliente) GET /map/branches?lat=&amp;lng=&amp;radiusKm=&amp;type=&amp;tags=&amp;verifiedOnly= GET /branches/{branchId} (perfil público) GET /tenants/{tenantId}/public (perfil público) Observación enterprise: el endpoint del mapa debe soportar paginación y “tiles” para performance. 3.10. UX/UI: pantallas mínimas (móvil y web) 3.10.1 App Cliente (móvil) Mapa (con filtros: tipo, verificado, distancia, rating). Lista (misma búsqueda del mapa, modo lista). Perfil de sucursal : ubicación, horarios, WhatsApp señales de confianza categorías/servicios reseñas (fase siguiente) Reportar (sospecha / estafa / información falsa). 3.10.2 Panel Negocio (web/móvil) Wizard de creación de negocio . Gestión de sucursales (editar, activar/desactivar, fotos, horarios). Verificación (subir docs, ver estado, responder observaciones). 3.10.3 Backoffice (interno) Bandeja de verificaciones . Vista de caso con checklist. Decisión + auditoría . 3.11. Paso a paso de implementación (como plan de obra) Paso 1 — Modelo y migraciones Crear tablas tenant , tenant_branch , verification_case . Activar RLS en tablas privadas si aplica. Agregar índices geo. Paso 2 — Servicios de negocio TenantService (crear/editar). BranchService (CRUD sucursales). Validaciones: duplicados por place id, límites por plan. Paso 3 — Motor geo Implementar MapQueryService : búsqueda por radio filtros por tipo/tags/verificado ranking inicial Paso 4 — Media y documentos Subida de fotos/documentos (Mongo + storage). Generar thumbnails. Paso 5 — Verificación VerificationWorkflow : submit → pending backoffice approve/reject auditoría Paso 6 — Observabilidad métricas de latencia del endpoint de mapa logs estructurados Paso 7 — Hardening rate limits antifraude básico (detección de duplicados, edición masiva) 3.12. Pruebas y criterios de “listo” 3.12.1 Casos de prueba esenciales Crear tenant + sucursal. Editar sucursal con @Version (concurrencia optimista). Query mapa por radio y filtros. Subir docs y crear caso de verificación. Backoffice aprueba → cambia estado. Usuario cliente ve badge “Verificado” . 3.12.2 Definición de listo Este módulo está listo cuando: - el mapa responde rápido y consistente, - las sucursales son reales (no duplicadas), - la verificación funciona con auditoría, - el ranking es razonable, - no hay fugas multiempresa. 3.13. Entregables de este capítulo Modelo tenant/sucursal + índices geo. Endpoints de mapa y perfiles públicos. Flujo de verificación (submit + backoffice). UI mínima (cliente + negocio + backoffice). Suite de smoke tests. 3.14. Cómo conecta con el Capítulo 4 Con negocios y mapa listos, el siguiente paso es definir la oferta : - Catálogo de productos/servicios/repuestos/garantías , con categorías, atributos y reglas. Fin del Capítulo 3
